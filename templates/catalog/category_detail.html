{% extends 'base.html' %}
{% load static %}

{% block title %}{{ category.name }} - Каталог{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <!-- Хлебные крошки -->
    <nav class="mb-6">
        <ol class="flex items-center space-x-2 text-sm text-gray-600">
            <li>
                <a href="{% url 'catalog:category_list' %}" class="hover:text-sitera-primary">Каталог</a>
            </li>
            <li>
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
            </li>
            <li class="text-gray-800 font-medium">{{ category.name }}</li>
        </ol>
    </nav>

    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-800 mb-4">{{ category.name }}</h1>
        {% if category.description %}
            <p class="text-gray-600 text-lg">{{ category.description }}</p>
        {% endif %}
    </div>

    <!-- Подкатегории -->
    {% if category.children.exists %}
    <div class="mb-8">
        <h2 class="text-xl font-semibold text-gray-800 mb-4">Подкатегории</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            {% for subcategory in category.children.all %}
            <a href="{{ subcategory.get_absolute_url }}" 
               class="bg-white p-4 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300">
                <h3 class="font-medium text-gray-800 mb-2">{{ subcategory.name }}</h3>
                <p class="text-sm text-gray-600">{{ subcategory.products.count }} товаров</p>
            </a>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Фильтры -->
    <div class="mb-6 bg-white p-4 rounded-lg shadow-md">
        <div class="flex flex-wrap items-center gap-4">
            <div class="flex items-center space-x-2">
                <label class="text-sm font-medium text-gray-700">Наличие:</label>
                <select id="availability-filter" class="border border-gray-300 rounded px-3 py-1 text-sm">
                    <option value="">Все</option>
                    <option value="in_stock">В наличии</option>
                    <option value="order">Под заказ</option>
                </select>
            </div>
            
            <div class="flex items-center space-x-2">
                <label class="text-sm font-medium text-gray-700">Сортировка:</label>
                <select id="sort-filter" class="border border-gray-300 rounded px-3 py-1 text-sm">
                    <option value="-created_at">Сначала новые</option>
                    <option value="created_at">Сначала старые</option>
                    <option value="title">По названию А-Я</option>
                    <option value="-title">По названию Я-А</option>
                    <option value="-views_count">По популярности</option>
                </select>
            </div>
        </div>
    </div>

    <!-- Товары -->
    <div class="mb-6">
        <h2 class="text-xl font-semibold text-gray-800 mb-4">
            Товары в категории {{ category.name }}
            <span class="text-sm font-normal text-gray-600">({{ products.count }})</span>
        </h2>
        
        <div id="products-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            {% for product in products %}
            <div class="bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300 product-card" 
                 data-availability="{{ product.availability }}">
                <div class="relative">
                    {% if product.preview_image %}
                        <img src="{{ product.preview_image.url }}" 
                             alt="{{ product.title }}" 
                             class="w-full h-48 object-cover rounded-t-lg">
                    {% else %}
                        <div class="w-full h-48 bg-gray-200 rounded-t-lg flex items-center justify-center">
                            <svg class="w-16 h-16 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                        </div>
                    {% endif %}
                    
                    <div class="absolute top-2 right-2">
                        <span class="px-2 py-1 text-xs font-medium rounded-full
                            {% if product.availability == 'in_stock' %}
                                bg-green-100 text-green-800
                            {% else %}
                                bg-yellow-100 text-yellow-800
                            {% endif %}">
                            {{ product.get_availability_display }}
                        </span>
                    </div>
                </div>
                
                <div class="p-4">
                    <h3 class="font-medium text-gray-800 mb-2 line-clamp-2">{{ product.title }}</h3>
                    
                    {% if product.article %}
                        <p class="text-sm text-gray-500 mb-2">Артикул: {{ product.article }}</p>
                    {% endif %}
                    
                    <p class="text-sm text-gray-600 mb-4 line-clamp-3">{{ product.description|truncatewords:15 }}</p>
                    
                    <div class="flex justify-between items-center">
                        <span class="text-xs text-gray-500">
                            {{ product.views_count }} просмотров
                        </span>
                        <a href="{{ product.get_absolute_url }}" 
                           class="inline-flex items-center text-sitera-primary hover:text-blue-700 text-sm font-medium">
                            Подробнее
                            <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                            </svg>
                        </a>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="col-span-full text-center py-12">
                <p class="text-gray-500 text-lg">Товары в этой категории пока не добавлены</p>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const availabilityFilter = document.getElementById('availability-filter');
    const sortFilter = document.getElementById('sort-filter');
    const productsContainer = document.getElementById('products-container');
    const productCards = document.querySelectorAll('.product-card');
    
    function filterProducts() {
        const availabilityValue = availabilityFilter.value;
        const sortValue = sortFilter.value;
        
        // Фильтрация по наличию
        productCards.forEach(card => {
            const cardAvailability = card.dataset.availability;
            if (availabilityValue === '' || cardAvailability === availabilityValue) {
                card.style.display = 'block';
            } else {
                card.style.display = 'none';
            }
        });
        
        // Сортировка (в реальном приложении это должно быть на бэкенде)
        // Здесь просто показываем, как можно было бы реализовать
        const visibleCards = Array.from(productCards).filter(card => card.style.display !== 'none');
        
        // В реальном приложении здесь был бы запрос на сервер с параметрами фильтрации и сортировки
    }
    
    availabilityFilter.addEventListener('change', filterProducts);
    sortFilter.addEventListener('change', filterProducts);
});
</script>
{% endblock %}